<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dear Labour: It's Time for Real Electoral Reform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úÖ</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <header class="govuk-header" role="banner">
        <div class="govuk-header__container">
            <a href="#" class="govuk-header__link govuk-header__link--homepage">
            ‚úÖ Dear Labour: It's Time for Real Electoral Reform</a>
        </div>
    </header>
    <div class="container">
        <div class="content">
            <p>
                The UK's "choose-one" First-Past-the-Post system guarantees a two-party dominance, forcing voters into tactical decisions rather than allowing them to vote for who they truly support.
            </p>

            <p><strong>The simplest, most effective solution is to let people vote for as many candidates as they approve of. This is Approval Voting.</strong></p>

            <p>This isn't a radical idea. It's a simple change that would empower voters and lead to a more representative government. For the Labour Party, a party of progress and reform, this is a historic opportunity to fix our broken political system.</p>

            <p><strong>For a party that wants to deliver a decade of national renewal, electoral reform is not just an option, it's a necessity.</strong></p>

            <div class="ballot-container">
                <div class="ballot-box ballot-box--plurality">
                    <div class="ballot-title ballot-title--plurality">
                        <h3>CURRENT BALLOT</h3>
                        <p class="ballot-subtitle ballot-subtitle--plurality">VOTE FOR <span>ONE</span></p>
                    </div>

                    <div class="ballot-options">
                        <div class="ballot-option">
                            <div class="ballot-radio"></div>
                            <label class="ballot-label">Reform UK</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-radio" ></div>
                            <label class="ballot-label">Conservative</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-radio"></div>
                            <label class="ballot-label">Liberal Democrats</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-radio" ></div>
                            <label class="ballot-label">Labour</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-radio"></div>
                            <label class="ballot-label">Green</label>
                        </div>
                    </div>

                    <div class="spoiler-warning">
                        ‚ö†Ô∏è Vote for Liberal Democrats or Green = "Spoiler"
                    </div>
                </div>

                <div class="ballot-box ballot-box--approval">
                    <div class="ballot-title ballot-title--approval">
                        <h3>APPROVAL BALLOT</h3>
                        <p class="ballot-subtitle ballot-subtitle--approval">VOTE FOR<br><span>ALL YOU APPROVE OF</span></p>
                    </div>

                    <div class="ballot-options">
                        <div class="ballot-option">
                            <div class="ballot-checkbox"></div>
                            <label class="ballot-label">Reform UK</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-checkbox"></div>
                            <label class="ballot-label">Conservative</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-checkbox ballot-checkbox--checked"></div>
                            <label class="ballot-label">Liberal Democrats</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-checkbox  ballot-checkbox--checked"></div>
                            <label class="ballot-label">Labour</label>
                        </div>
                        <div class="ballot-option">
                            <div class="ballot-checkbox  ballot-checkbox--checked"></div>
                            <label class="ballot-label">Green</label>
                        </div>
                    </div>

                    <div class="favorites-message">
                        ‚úÖ Vote for favorites without penalty!
                    </div>
                </div>
            </div>

            <h2 class="section-header">Single-Winner Elections: A Clear Mandate for Mayors</h2>
            <p>For single-winner elections, like those for directly elected mayors, Approval Voting is the ideal system. It ensures the winner has the broadest possible support from the electorate. Unlike FPTP, where a candidate can win with a small plurality of the vote, Approval Voting elects the candidate who is approved of by the most voters. This leads to winners with a stronger mandate and reduces the "spoiler effect," where voters are afraid to vote for their true favorite for fear of helping their least favorite candidate win.</p>

            <h2 class="section-header">Parliamentary Elections: Fair Share Voting</h2>
            <p>For parliamentary elections, we can use Proportional Approval Voting to achieve a proportionally representative Parliament. This system combines the simplicity of Approval Voting with the fairness of Proportional Representation. Voters can vote for as many candidates as they approve of, and the results are used to elect a proportional slate of representatives. This system ensures that all votes matter and that Parliament accurately reflects the diversity of political opinion in the country.</p>

            <h2 class="section-header">How Fair Share Voting Works</h2>
            
            <div class="pav-explanation">
                <h3>üó≥Ô∏è The Ballot</h3>
                <p>Under Fair Share Voting, you can approve as many parties as you like:</p>
                
                <div class="ballot-example">
                    <div class="ballot-part">
                        <h4>The Ballot</h4>
                        <p>Approve ANY parties you'd be happy to see in Parliament:</p>
                        <ul class="party-list">
                            <li><input type="checkbox" id="party-labour" class="party-checkbox"> <label for="party-labour">Labour Party</label></li>
                            <li><input type="checkbox" id="party-conservative" class="party-checkbox"> <label for="party-conservative">Conservative Party</label></li>
                            <li><input type="checkbox" id="party-libdem" class="party-checkbox"> <label for="party-libdem">Liberal Democrat Party</label></li>
                            <li><input type="checkbox" id="party-green" class="party-checkbox"> <label for="party-green">Green Party</label></li>
                            <li><input type="checkbox" id="party-reform" class="party-checkbox"> <label for="party-reform">Reform UK</label></li>
                        </ul>
                        <p class="hint">‚úì You can approve multiple parties!</p>
                    </div>
                </div>
                
                <h3>üìä How Seats Are Allocated</h3>
                <p>The system uses a "Fair Share" approach to ensure proportional representation:</p>
                
                <div class="allocation-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Count Party Approvals</h4>
                            <p>Count how many voters approved each party nationwide</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Apply Threshold</h4>
                            <p>Parties must receive at least 3% of total approvals to qualify for seats</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Allocate Seats Using SPAV</h4>
                            <p>Sequential Proportional Approval Voting ensures proportional representation across all 650 seats</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Parties Select MPs</h4>
                            <p>Each party chooses which candidates fill their seats, considering popularity, geography, and diversity</p>
                        </div>
                    </div>
                </div>

                <div class="spav-explanation">
                    <h4>üìê How SPAV Works for Parties</h4>
                    <p>Sequential Proportional Approval Voting (SPAV) ensures fair representation:</p>
                    <ul>
                        <li>First seat goes to the party with the most approvals</li>
                        <li>Voters who approved that party have their "voting power" reduced for the next round</li>
                        <li>This prevents any group from dominating all the seats</li>
                        <li>The process repeats until all 650 seats are filled</li>
                        <li>Result: Each party's seat share closely matches their approval share</li>
                    </ul>
                </div>
                
                <h3>üèÜ A Real Example</h3>
                <p>Based on current polling (approximate):</p>
                
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Party</th>
                            <th>Vote Share</th>
                            <th>FPTP Seats (projected)</th>
                            <th>Proportional Seats</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Reform UK</td>
                            <td>26%</td>
                            <td>450+</td>
                            <td>169</td>
                        </tr>
                        <tr>
                            <td>Labour</td>
                            <td>25%</td>
                            <td>100-150</td>
                            <td>162</td>
                        </tr>
                        <tr>
                            <td>Conservative</td>
                            <td>21%</td>
                            <td>50-100</td>
                            <td>136</td>
                        </tr>
                        <tr>
                            <td>Liberal Democrats</td>
                            <td>15%</td>
                            <td>20-40</td>
                            <td>97</td>
                        </tr>
                        <tr>
                            <td>Green</td>
                            <td>9%</td>
                            <td>1-3</td>
                            <td>58</td>
                        </tr>
                    </tbody>
                </table>
                
                <div class="pav-benefits">
                    <h3>‚úÖ Why This Matters</h3>
                    <ul>
                        <li><strong>True Representation:</strong> Seat share matches vote share - no more artificial majorities</li>
                        <li><strong>Every Vote Counts:</strong> No "safe seats" or "wasted votes" - your voice matters everywhere</li>

                        <li><strong>Regional Balance:</strong> Parties incentivized to select MPs from all parts of the UK</li>
                        <li><strong>Diversity:</strong> Encourages selection of candidates representing all demographics</li>
                        <li><strong>Coalition Building:</strong> Parties must work together and find common ground</li>
                        <li><strong>Party Accountability:</strong> Selection criteria must be transparent and justified</li>
                    </ul>
                </div>
            </div>

            <h2 class="section-header">Why the Alternative Vote Failed and What We Can Learn</h2>
            <p>In 2011, the UK rejected the Alternative Vote (AV). A key reason for its failure was its complexity. Voters struggled to understand the mechanics of ranking candidates and the subsequent rounds of runoffs. This complexity made it easy for opponents to brand it as a "politician's choice" and sow confusion and doubt.</p><p>In contrast, Approval Voting is simple and intuitive. You vote for as many candidates as you approve of, and the candidate with the most votes wins. This straightforwardness makes it more transparent and easier for voters to understand, ensuring that the winner has the broadest support. The failure of AV was not a rejection of all electoral reform, but a clear lesson that simplicity and clarity are essential for any successful change.</p>

            <h2 class="section-header">Why Not Ranked Choice Voting (RCV) or Single Transferable Vote (STV)?</h2>
            
            <div class="comparison-section">
                <p>While RCV and STV are improvements over First Past the Post, they have significant drawbacks compared to Approval Voting:</p>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h3>ü§î Complexity</h3>
                        <div class="comparison-content">
                            <div class="rcv-side">
                                <h4>RCV/STV</h4>
                                <ul>
                                    <li>Requires ranking many candidates in order</li>
                                    <li>Complex counting with multiple rounds</li>
                                    <li>Results can take days to determine</li>
                                    <li>Difficult to explain to voters</li>
                                </ul>
                            </div>
                            <div class="approval-side">
                                <h4>Approval Voting</h4>
                                <ul>
                                    <li>Simply approve or don't approve</li>
                                    <li>Count once, winner immediately clear</li>
                                    <li>Results available election night</li>
                                    <li>Anyone can understand in seconds</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comparison-item">
                        <h3>üó≥Ô∏è Ballot Errors</h3>
                        <div class="comparison-content">
                            <div class="rcv-side">
                                <h4>RCV/STV</h4>
                                <ul>
                                    <li>High spoilage rate (3-5% typical)</li>
                                    <li>Voters make ranking mistakes</li>
                                    <li>Exhausted ballots don't count</li>
                                    <li>Strategic ranking is complex</li>
                                </ul>
                            </div>
                            <div class="approval-side">
                                <h4>Approval Voting</h4>
                                <ul>
                                    <li>Near-zero spoilage rate</li>
                                    <li>No way to invalidate ballot</li>
                                    <li>Every vote always counts</li>
                                    <li>Strategy is straightforward</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comparison-item">
                        <h3>üìä Representation</h3>
                        <div class="comparison-content">
                            <div class="rcv-side">
                                <h4>RCV/STV</h4>
                                <ul>
                                    <li>Can elect polarizing candidates</li>
                                    <li>Center squeeze effect</li>
                                    <li>Doesn't measure broad support</li>
                                </ul>
                            </div>
                            <div class="approval-side">
                                <h4>Approval Voting</h4>
                                <ul>
                                    <li>Elects consensus candidates</li>
                                    <li>No center squeeze</li>
                                    <li>Encourages honest voting</li>
                                    <li>Measures true support levels</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comparison-item">
                        <h3>üí∞ Implementation</h3>
                        <div class="comparison-content">
                            <div class="rcv-side">
                                <h4>RCV/STV</h4>
                                <ul>
                                    <li>Expensive new voting machines</li>
                                    <li>Complex software required</li>
                                    <li>Extensive voter education needed</li>
                                    <li>Difficult to audit</li>
                                </ul>
                            </div>
                            <div class="approval-side">
                                <h4>Approval Voting</h4>
                                <ul>
                                    <li>Works with existing equipment</li>
                                    <li>Simple software update</li>
                                    <li>Minimal education required</li>
                                    <li>Easy to audit and verify</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="real-world-examples">
                    <h3>üåç Real-World Evidence</h3>
                    <div class="example-grid">
                        <div class="example">
                            <h4>Burlington, Vermont (2009)</h4>
                            <p>RCV elected the candidate who would have lost head-to-head against either opponent. The system was repealed after this failure.</p>
                        </div>
                        <div class="example">
                            <h4>Australia's Senate</h4>
                            <p>STV ballots are so complex that 95%+ of voters just vote "above the line," letting parties control their preferences.</p>
                        </div>
                        <div class="example">
                            <h4>Fargo, North Dakota (2020)</h4>
                            <p>First US city to adopt Approval Voting. Voter satisfaction increased, and results clearly reflected community consensus.</p>
                        </div>
                        <div class="example">
                            <h4>St. Louis, Missouri (2021)</h4>
                            <p>Adopted Approval Voting with 70% support. First election saw higher turnout and broad coalition building.</p>
                        </div>
                    </div>
                </div>
                
                <div class="key-takeaway">
                    <h3>üéØ The Bottom Line</h3>
                    <p>While RCV and STV are improvements over FPTP, they introduce unnecessary complexity without delivering better outcomes. Approval Voting achieves all the benefits of electoral reform while remaining simple enough for anyone to understand and use effectively.</p>
                    <p><strong>Remember:</strong> The best voting system is one that voters trust and understand. Approval Voting's simplicity is its greatest strength.</p>
                </div>
            </div>

            <h2 class="section-header">Better Coalitions with Proportional Approval Voting</h2>
            <p>Under First Past the Post, coalition governments are rare and often unstable. When they do form, they are typically between two parties with very different platforms, leading to policy gridlock and voter dissatisfaction. Proportional Approval Voting, on the other hand, encourages the formation of stable, effective coalitions. Because parties are incentivized to seek broad approval from the electorate, they are more likely to find common ground and work together. This leads to more representative and effective governance, as coalitions are built on shared policy goals rather than political expediency.</p>

            <h2 class="section-header">Meeting the 'Good Systems Agreement' Principles</h2>
            <p>Proportional Approval Voting aligns with the key principles of the "Good Systems Agreement" from Make Votes Matter:</p>
            <ul>
                <li><strong>Proportionality:</strong> Seats would closely match the votes cast for each party.</li>
                <li><strong>Representation:</strong> MPs and governments would better represent the views of the voters.</li>
                <li><strong>Equal votes:</strong> The value of individual votes would not be distorted by geography, and tactical voting would be minimised.</li>
                <li><strong>Local links:</strong> The system can be designed to maintain links between MPs and specific geographic areas.</li>
                <li><strong>Diversity:</strong> It would encourage the election of parliaments that reflect the population.</li>
                <li><strong>Voter choice:</strong> Voters would have a wide choice of parties and could express preferences for people rather than just parties.</li>
                <li><strong>Accountability:</strong> MPs and governments would be more accountable to the voters.</li>
                <li><strong>Balance of stability and flexibility:</strong> It would engender stable, flexible government with the ability to compromise.</li>
                <li><strong>Sustainability and adaptability:</strong> The system would be able to respond and adapt to changing needs.</li>
                <li><strong>Voting simplicity:</strong> The ballot papers would be easy for voters to understand and use.</li>
            </ul>

            <h2 class="section-header">Draft Legislative Language</h2>
            <p>To implement Fair Share Voting (based on Approval Voting, <strong>not</strong> the Alternative Vote/RCV) in the UK, we propose the following legislative framework:</p>

            <div class="legislative-section">
                <h3>Key Definitions</h3>
                <div class="definition-box">
                    <h4>Fair Share Voting</h4>
                    <p>A voting system based on Approval Voting where electors may indicate approval for as many candidates as they wish. This is <strong>fundamentally different</strong> from the Alternative Vote (ranked choice voting) rejected in the 2011 referendum.</p>
                </div>
                
                <h3>For Single-Winner Elections (Mayors, Police Commissioners)</h3>
                <div class="legal-text">
                    <h4>Amendment to Section 9HB of the Local Government Act 2000</h4>
                    <p class="legal-quote">"In elections for directly elected mayors:</p>
                    <ol class="legal-list">
                        <li>Each elector shall be entitled to indicate approval for as many candidates as they wish by marking an 'X' next to each approved candidate's name.</li>
                        <li>The candidate receiving approval from the greatest number of electors shall be declared elected.</li>
                        <li>In the event of a tie, the returning officer shall decide by lot.</li>
                        <li>This system, known as Fair Share Voting for single-winner elections, replaces the supplementary vote system."</li>
                    </ol>
                </div>

                <h3>For Parliamentary Elections</h3>
                <div class="legal-text">
                    <h4>Proposed Fair Share Voting (Parliamentary Elections) Act</h4>
                    
                    <h5>Section 1: Voting Method</h5>
                    <p class="legal-quote">"In elections to the House of Commons:</p>
                    <ol class="legal-list">
                        <li>Elections shall be conducted at-large across the United Kingdom as a single constituency.</li>
                        <li>Each registered political party shall submit an ordered list of candidates prior to the election.</li>
                        <li>Each elector may indicate approval for one or more political parties registered under the Political Parties, Elections and Referendums Act 2000.</li>
                        <li>Approval is indicated by marking an 'X' in the appropriate box. There is no ranking of preferences.</li>
                    </ol>
                    
                    <h5>Section 2: Allocation of Seats</h5>
                    <p class="legal-quote">"Seats shall be allocated as follows:</p>
                    <ol class="legal-list">
                        <li>The total number of approvals received by each party shall be calculated.</li>
                        <li>Seats shall be allocated to parties using Sequential Proportional Approval Voting (SPAV):
                            <ul>
                                <li>(a) The party with the most approvals receives the first seat;</li>
                                <li>(b) For each subsequent seat, the voting weight of ballots that approved already-seated parties is reduced proportionally;</li>
                                <li>(c) The party with the highest weighted approval score receives the next seat;</li>
                                <li>(d) This process continues until all 650 seats are allocated.</li>
                            </ul>
                        </li>
                        <li>Within each party's allocation:
                            <ul>
                                <li>(a) Each party shall determine which of its candidates fill the allocated seats;</li>
                                <li>(b) Parties are strongly encouraged to consider:
                                    <ul>
                                        <li>(i) Geographic representation across all regions of the United Kingdom;</li>
                                        <li>(ii) Demographic diversity including but not limited to gender, ethnicity, age, and socioeconomic background;</li>
                                    </ul>
                                </li>
                                <li>(c) Parties must publish their selection criteria and process prior to the election;</li>
                                <li>(d) The Electoral Commission shall monitor and report on parties' adherence to representation principles.</li>
                            </ul>
                        </li>
                        <li>A minimum threshold of 3% of total approvals shall be required for a party to receive any seats.</li>
                    </ol>

                    <h5>Section 3: Transitional Provisions</h5>
                    <p class="legal-quote">"The Fair Share Voting system shall:</p>
                    <ol class="legal-list">
                        <li>Be implemented at the next general election following Royal Assent;</li>
                        <li>Be reviewed by an independent commission after two general elections;</li>
                        <li>Not require a referendum, as it is distinct from the Alternative Vote system rejected in 2011.</li>
                    </ol>
                </div>

                <h3>Key Distinctions from Alternative Vote</h3>
                <div class="distinction-box">
                    <p><strong>Fair Share Voting (Approval-based):</strong></p>
                    <ul>
                        <li>Voters approve multiple candidates equally</li>
                        <li>No ranking or preference ordering</li>
                        <li>Simple to understand and count</li>
                        <li>Reduces tactical voting</li>
                        <li>Proportional in multi-member districts</li>
                    </ul>
                    
                    <p><strong>Alternative Vote (Ranked Choice):</strong></p>
                    <ul>
                        <li>Voters rank candidates in order</li>
                        <li>Complex preference transfers</li>
                        <li>Can be confusing and lead to spoiled ballots</li>
                        <li>Still enables tactical voting</li>
                        <li>Not proportional</li>
                    </ul>
                </div>

                <h3>Implementation Timeline</h3>
                <div class="timeline-box">
                    <p><strong>Year 1:</strong> Legislation passed, Boundary Commission begins constituency review</p>
                    <p><strong>Year 2:</strong> New multi-member constituencies established, public education campaign</p>
                    <p><strong>Year 3:</strong> Pilot elections in local authorities</p>
                    <p><strong>Year 4:</strong> First general election under Fair Share Voting</p>
                </div>
            </div>

            <h2 class="section-header">See The Difference In Action</h2>
            <p>Same voters, same candidates, dramatically different results.</p>

            <div class="ballot-controls" style="text-align: center; margin: 2rem 0; padding: 1.5rem; background: #f9f9f9; border-radius: 0.5rem;">
                <label for="ballot-slider" style="display: block; margin-bottom: 1rem; font-weight: bold; font-size: 1.125rem;">Number of Ballots: <span id="ballot-count">6</span></label>
                <input type="range" id="ballot-slider" min="1" max="100" value="6" style="width: 100%; max-width: 400px; height: 8px; cursor: pointer;">
                <div style="display: flex; justify-content: space-between; max-width: 400px; margin: 0.5rem auto 0; font-size: 0.875rem; color: #666;">
                    <span>1</span>
                    <span>25</span>
                    <span>50</span>
                    <span>75</span>
                    <span>100</span>
                </div>
            </div>

            <div class="demo-section">
                <div class="demo-column">
                    <div class="section-title plurality-title">Current System (Choose ONE)</div>
                    <div id="plurality-ballots"></div>
                </div>

                <div class="demo-column">
                    <div class="section-title approval-title">Approval Voting (Single Winner)</div>
                    <div id="approval-ballots"></div>
                </div>
            </div>

            <div class="results-layout">
                <div class="results-box plurality-results">
                    <div class="results-title">Choose One Results</div>
                    <div id="plurality-results"></div>
                    <div id="plurality-winner" class="winner-announcement plurality-winner"></div>
                </div>
                <div class="results-box approval-results">
                    <div class="results-title">Approval Results</div>
                    <div id="approval-results"></div>
                    <div id="approval-winner" class="winner-announcement approval-winner"></div>
                </div>
            </div>
            <div style="margin-top: 2rem;">
                <div class="section-title approval-title">Proportional Approval Voting (Parliament)</div>
                 <div class="results-box proportional-results">
                    <div id="proportional-chart"></div>
                    <div id="proportional-legend" class="chart-legend"></div>
                    <div id="proportional-winner" class="winner-announcement approval-winner"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variable to track current ballot count
        let currentBallotCount = 6;
        
        // Simple, bulletproof JavaScript without complex operations
        function createBallots(ballotCount) {
            const pluralityContainer = document.getElementById('plurality-ballots');
            const approvalContainer = document.getElementById('approval-ballots');

            if (!pluralityContainer || !approvalContainer) return;

            const candidates = ['Reform UK', 'Conservative', 'Liberal Democrats', 'Labour', 'Green'];
            const candidateKeys = ['reform-uk', 'conservative', 'liberal-democrats', 'labour', 'green'];

            // Create plurality ballots
            pluralityContainer.innerHTML = '';
            for (let voter = 1; voter <= ballotCount; voter++) {
                let ballotHTML = '<div class="ballot"><h4>Voter ' + voter + '</h4>';
                for (let i = 0; i < candidates.length; i++) {
                    ballotHTML += '<div class="candidate-option">';
                    ballotHTML += '<input type="radio" name="plurality-' + voter + '" value="' + candidateKeys[i] + '" onchange="updateResults()" id="p-' + voter + '-' + candidateKeys[i] + '">';
                    ballotHTML += '<label for="p-' + voter + '-' + candidateKeys[i] + '">' + candidates[i] + '</label>';
                    ballotHTML += '</div>';
                }
                ballotHTML += '</div>';
                pluralityContainer.innerHTML += ballotHTML;
            }

            // Create approval ballots
            approvalContainer.innerHTML = '';
            for (let voter = 1; voter <= ballotCount; voter++) {
                let ballotHTML = '<div class="ballot"><h4>Voter ' + voter + '</h4>';
                for (let i = 0; i < candidates.length; i++) {
                    ballotHTML += '<div class="candidate-option">';
                    ballotHTML += '<input type="checkbox" name="approval-' + voter + '-' + candidateKeys[i] + '" onchange="updateResults()" id="a-' + voter + '-' + candidateKeys[i] + '">';
                    ballotHTML += '<label for="a-' + voter + '-' + candidateKeys[i] + '">' + candidates[i] + '</label>';
                    ballotHTML += '</div>';
                }
                ballotHTML += '</div>';
                approvalContainer.innerHTML += ballotHTML;
            }
        }

        // Function to randomly assign votes to a ballot
        function assignRandomVotes(voterNumber) {
            const candidateKeys = ['reform-uk', 'conservative', 'liberal-democrats', 'labour', 'green'];
            
            // Randomly select one candidate for plurality vote
            const pluralityChoice = candidateKeys[Math.floor(Math.random() * candidateKeys.length)];
            document.getElementById('p-' + voterNumber + '-' + pluralityChoice).checked = true;
            
            // Determine how many approvals to assign (70% = 1, 20% = 2, 10% = 3)
            let numApprovals;
            const rand = Math.random();
            if (rand < 0.7) {
                numApprovals = 1;
            } else if (rand < 0.9) {
                numApprovals = 2;
            } else {
                numApprovals = 3;
            }
            
            // Shuffle candidates and select the first numApprovals
            const shuffledCandidates = [...candidateKeys];
            for (let i = shuffledCandidates.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledCandidates[i], shuffledCandidates[j]] = [shuffledCandidates[j], shuffledCandidates[i]];
            }
            
            // Assign approval votes
            for (let i = 0; i < numApprovals; i++) {
                document.getElementById('a-' + voterNumber + '-' + shuffledCandidates[i]).checked = true;
            }
        }
        

        
        // Function to save current vote state
        function saveCurrentVotes() {
            const votes = {
                plurality: {},
                approval: {}
            };
            
            for (let voter = 1; voter <= currentBallotCount; voter++) {
                // Save plurality votes
                const pluralityChecked = document.querySelector('input[name="plurality-' + voter + '"]:checked');
                if (pluralityChecked) {
                    votes.plurality[voter] = pluralityChecked.value;
                }
                
                // Save approval votes
                votes.approval[voter] = [];
                const candidateKeys = ['reform-uk', 'conservative', 'liberal-democrats', 'labour', 'green'];
                candidateKeys.forEach(candidate => {
                    const checkbox = document.getElementById('a-' + voter + '-' + candidate);
                    if (checkbox && checkbox.checked) {
                        votes.approval[voter].push(candidate);
                    }
                });
            }
            
            return votes;
        }
        
        // Function to restore saved votes
        function restoreVotes(savedVotes) {
            // Restore plurality votes
            for (let voter in savedVotes.plurality) {
                const radio = document.getElementById('p-' + voter + '-' + savedVotes.plurality[voter]);
                if (radio) radio.checked = true;
            }
            
            // Restore approval votes
            for (let voter in savedVotes.approval) {
                savedVotes.approval[voter].forEach(candidate => {
                    const checkbox = document.getElementById('a-' + voter + '-' + candidate);
                    if (checkbox) checkbox.checked = true;
                });
            }
        }
        
        // Function to update ballot count display
        function updateBallotCount() {
            const countElement = document.getElementById('ballot-count');
            if (countElement) {
                countElement.textContent = currentBallotCount;
            }
        }
        
        function setDemoScenario() {
            resetAllBallots();

            // Scenario: 6 voters in a constituency.
            // Voter preferences that might lead to a proportional outcome.

            // Plurality Votes (tactical voting is common)
            if (document.getElementById('p-1-green')) document.getElementById('p-1-green').checked = true;
            if (document.getElementById('p-2-labour')) document.getElementById('p-2-labour').checked = true;
            if (document.getElementById('p-3-conservative')) document.getElementById('p-3-conservative').checked = true;
            if (document.getElementById('p-4-conservative')) document.getElementById('p-4-conservative').checked = true;
            if (document.getElementById('p-5-liberal-democrats')) document.getElementById('p-5-liberal-democrats').checked = true;
            if (document.getElementById('p-6-labour')) document.getElementById('p-6-labour').checked = true;

            // Approval Votes (express true preferences)
            // 2 Labour-Green voters
            if (document.getElementById('a-1-labour')) document.getElementById('a-1-labour').checked = true;
            if (document.getElementById('a-1-green')) document.getElementById('a-1-green').checked = true;
            if (document.getElementById('a-2-liberal-democrats')) document.getElementById('a-2-liberal-democrats').checked = true;
            if (document.getElementById('a-2-labour')) document.getElementById('a-2-labour').checked = true;
            // 2 Conservative-Reform voters
            if (document.getElementById('a-3-conservative')) document.getElementById('a-3-conservative').checked = true;
            if (document.getElementById('a-3-reform-uk')) document.getElementById('a-3-reform-uk').checked = true;
            if (document.getElementById('a-4-conservative')) document.getElementById('a-4-conservative').checked = true;
            if (document.getElementById('a-4-liberal-democrats')) document.getElementById('a-4-liberal-democrats').checked = true;
            // 1 Lib Dem-Green-Labour voter
            if (document.getElementById('a-5-liberal-democrats')) document.getElementById('a-5-liberal-democrats').checked = true;
            if (document.getElementById('a-5-green')) document.getElementById('a-5-green').checked = true;
            if (document.getElementById('a-5-labour')) document.getElementById('a-5-labour').checked = true;
            // 1 Reform-Conservative-Lib Dem voter
            if (document.getElementById('a-6-reform-uk')) document.getElementById('a-6-reform-uk').checked = true;
            if (document.getElementById('a-6-green')) document.getElementById('a-6-green').checked = true;
            if (document.getElementById('a-6-labour')) document.getElementById('a-6-labour').checked = true;

            updateResults();
        }

        function updateResults() {
            updatePluralityResults();
            updateApprovalResults();
        }

        function updatePluralityResults() {
            const votes = { 'reform-uk': 0, conservative: 0, 'liberal-democrats': 0, labour: 0, green: 0 };

            for (let i = 1; i <= currentBallotCount; i++) {
                const checked = document.querySelector('input[name="plurality-' + i + '"]:checked');
                if (checked) {
                    votes[checked.value]++;
                }
            }

            displayResults('plurality-results', votes, 'plurality-winner');
        }

        function updateApprovalResults() {
            const votes = { 'reform-uk': 0, conservative: 0, 'liberal-democrats': 0, labour: 0, green: 0 };
            const candidates = ['reform-uk', 'conservative', 'liberal-democrats', 'labour', 'green'];

            for (let i = 1; i <= currentBallotCount; i++) {
                for (let j = 0; j < candidates.length; j++) {
                    const checkbox = document.getElementById('a-' + i + '-' + candidates[j]);
                    if (checkbox && checkbox.checked) {
                        votes[candidates[j]]++;
                    }
                }
            }

            displayResults('approval-results', votes, 'approval-winner');
            drawParliamentChart(votes);
        }

        function displayResults(containerId, votes, winnerId) {
            const container = document.getElementById(containerId);
            const winnerDiv = document.getElementById(winnerId);
            if (!container || !winnerDiv) return;

            const candidates = [
                { key: 'reform-uk', name: 'Reform UK', class: 'reform-uk' },
                { key: 'conservative', name: 'Conservative', class: 'conservative' },
                { key: 'liberal-democrats', name: 'Liberal Democrats', class: 'liberal-democrats' },
                { key: 'labour', name: 'Labour', class: 'labour' },
                { key: 'green', name: 'Green', class: 'green' }
            ];

            let html = '';
            let maxVotes = 0;
            let winners = [];
            candidates.forEach(c => {
                if (votes[c.key] > maxVotes) maxVotes = votes[c.key];
            });
            candidates.forEach(c => {
                if (votes[c.key] === maxVotes && maxVotes > 0) winners.push(c.name);
            });

            candidates.forEach(candidate => {
                const voteCount = votes[candidate.key];
                const barWidth = voteCount > 0 ? (voteCount / currentBallotCount) * 100 : 0;
                html += `<div class="result-bar"><div class="bar ${candidate.class}" style="width: ${barWidth}%;"></div><div class="bar-text">${candidate.name}: ${voteCount}</div></div>`;
            });

            if (maxVotes > 0) {
                winnerDiv.innerHTML = 'üèÜ ' + (winners.length > 1 ? 'Tie: ' + winners.join(' & ') : winners[0] + ' Wins!');
            } else {
                winnerDiv.innerHTML = 'Click ballots to vote';
            }
            container.innerHTML = html;
        }

        function drawParliamentChart(votes) {
            const chartContainer = document.getElementById('proportional-chart');
            const winnerDiv = document.getElementById('proportional-winner');
            if (!chartContainer || !winnerDiv) return;

            chartContainer.innerHTML = ''; // Clear previous chart
            winnerDiv.innerHTML = '';

            const candidates = [
                { key: 'reform-uk', name: 'Reform UK', color: '#12B6CF' },
                { key: 'conservative', name: 'Conservative', color: '#0087DC' },
                { key: 'liberal-democrats', name: 'Liberal Democrats', color: '#FAA61A' },
                { key: 'labour', name: 'Labour', color: '#E4003B' },
                { key: 'green', name: 'Green', color: '#6AB023' }
            ];

            const totalSeats = 650; // Full UK Parliament
            let totalApprovalVotes = 0;
            candidates.forEach(c => totalApprovalVotes += votes[c.key]);

            if (totalApprovalVotes === 0) {
                winnerDiv.innerHTML = 'Click ballots to vote';
                return;
            }

            const seats = {};
            const remainders = {};
            let seatsAllocated = 0;

            candidates.forEach(c => {
                const voteCount = votes[c.key];
                const proportion = voteCount / totalApprovalVotes;
                const exactSeats = proportion * totalSeats;
                seats[c.key] = Math.floor(exactSeats);
                remainders[c.key] = exactSeats - Math.floor(exactSeats);
                seatsAllocated += seats[c.key];
            });

            const remainingSeats = totalSeats - seatsAllocated;
            const sortedRemainders = Object.keys(remainders).sort((a, b) => remainders[b] - remainders[a]);

            for (let i = 0; i < remainingSeats; i++) {
                seats[sortedRemainders[i]]++;
            }

            const chartData = [];
            const seatDistribution = [];
            candidates.forEach(c => {
                const seatCount = seats[c.key] || 0;
                if (seatCount > 0) {
                    seatDistribution.push(`${c.name}: ${seatCount}`);
                    chartData.push({
                        seats: seatCount,
                        color: c.color,
                        name: c.name
                    });
                }
            });

            // Create mobile-friendly parliamentary chart
            createMobileParliamentChart(chartContainer, chartData);

            winnerDiv.innerHTML = 'üèÜ Seat Allocation: ' + seatDistribution.join(', ');
        }

        function createMobileParliamentChart(container, data) {
            if (!data || data.length === 0) return;

            const totalSeats = data.reduce((sum, item) => sum + item.seats, 0);
            if (totalSeats === 0) return;

            // Create the chart container
            const chartWrapper = document.createElement('div');
            chartWrapper.className = 'mobile-parliament-chart';
            
            // Append wrapper to container first to get proper width
            container.appendChild(chartWrapper);
            
            // Create canvas element
            const canvas = document.createElement('canvas');
            canvas.className = 'parliament-canvas';
            
            // Set canvas size based on container
            const containerWidth = chartWrapper.offsetWidth || container.offsetWidth || 600;
            
            // Ensure canvas fits within container with some padding
            const padding = 32; // Total horizontal padding
            const maxWidth = Math.min(containerWidth - padding, 600);
            const canvasWidth = Math.max(320, maxWidth); // Min 320px for very narrow screens
            
            // Adjust aspect ratio for different screen sizes
            let aspectRatio = 0.5; // Default
            if (canvasWidth < 400) {
                aspectRatio = 0.7; // Much taller on phones
            } else if (canvasWidth < 500) {
                aspectRatio = 0.6; // Taller on small tablets
            }
            const canvasHeight = canvasWidth * aspectRatio;
            
            // Set actual canvas dimensions (for retina displays)
            const dpr = window.devicePixelRatio || 1;
            canvas.width = canvasWidth * dpr;
            canvas.height = canvasHeight * dpr;
            canvas.style.width = canvasWidth + 'px';
            canvas.style.height = canvasHeight + 'px';
            
            const ctx = canvas.getContext('2d');
            ctx.scale(dpr, dpr);
            
            // Parliament chart parameters (following d3-parliament-chart approach)
            // For 650 seats, we need smaller seats and tighter rows
            // Scale based on screen size
            let seatRadius, rowHeight;
            
            if (canvasWidth < 350) { // iPhone SE and similar
                seatRadius = 2.5;
                rowHeight = 6;
            } else if (canvasWidth < 400) { // Standard phones
                seatRadius = 3;
                rowHeight = 7;
            } else if (canvasWidth < 500) { // Large phones/small tablets
                seatRadius = 4;
                rowHeight = 8;
            } else { // Tablets and desktop
                seatRadius = 5;
                rowHeight = 10;
            }
            
            const options = {
                sections: 1,
                sectionGap: 0,
                seatRadius: seatRadius,
                rowHeight: rowHeight
            };
            
            // Calculate seat positions using the d3-parliament-chart algorithm
            const totalSeatsInChart = data.reduce((sum, item) => sum + item.seats, 0);
            const seatPositions = calculateParliamentPoints(totalSeatsInChart, options, canvasWidth);
            
            // Sort seat positions by angle (left to right)
            // First add angle back to positions for sorting
            const seatPositionsWithAngle = seatPositions.map((pos, index) => {
                // Calculate angle from position
                const dx = pos.x - (canvasWidth / 2);
                const dy = (canvasHeight) - pos.y;
                const angle = Math.atan2(dy, dx);
                return { ...pos, angle: angle };
            });
            
            // Sort by angle (left to right in semi-circle)
            seatPositionsWithAngle.sort((a, b) => b.angle - a.angle);
            
            // Create a mapping of seats to parties
            const seatData = [];
            let seatIndex = 0;
            
            // Assign parties to seats in order (left to right)
            data.forEach(party => {
                for (let i = 0; i < party.seats; i++) {
                    if (seatIndex < seatPositionsWithAngle.length) {
                        seatData.push({
                            x: seatPositionsWithAngle[seatIndex].x,
                            y: seatPositionsWithAngle[seatIndex].y,
                            color: party.color,
                            name: party.name,
                            partySeats: party.seats
                        });
                        seatIndex++;
                    }
                }
            });
            
            // Draw seats on canvas
            // Disable shadows for better performance with 650 seats
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            
            seatData.forEach(seat => {
                ctx.beginPath();
                ctx.arc(seat.x, seat.y, options.seatRadius, 0, 2 * Math.PI);
                ctx.fillStyle = seat.color;
                ctx.fill();
                // Lighter stroke for 650 seats
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 0.5;
                ctx.stroke();
            });
            
            // Append canvas to wrapper
            chartWrapper.appendChild(canvas);
            
            // Add hover functionality
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) * dpr;
                const y = (e.clientY - rect.top) * dpr;
                
                // Find if mouse is over a seat
                let hoveredSeat = null;
                seatData.forEach(seat => {
                    const distance = Math.sqrt(
                        Math.pow(x - seat.x * dpr, 2) + 
                        Math.pow(y - seat.y * dpr, 2)
                    );
                    if (distance <= options.seatRadius * dpr) {
                        hoveredSeat = seat;
                    }
                });
                
                canvas.style.cursor = hoveredSeat ? 'pointer' : 'default';
                if (hoveredSeat) {
                    canvas.title = `${hoveredSeat.name}: ${hoveredSeat.partySeats} seats`;
                } else {
                    canvas.title = '';
                }
            });
            
            // Create legend
            const legend = document.createElement('div');
            legend.className = 'parliament-legend';
            
            data.forEach(party => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const colorBox = document.createElement('div');
                colorBox.className = 'legend-color';
                colorBox.style.backgroundColor = party.color;
                
                const label = document.createElement('span');
                label.className = 'legend-label';
                label.textContent = `${party.name}: ${party.seats}`;
                
                legendItem.appendChild(colorBox);
                legendItem.appendChild(label);
                legend.appendChild(legendItem);
            });
            
            chartWrapper.appendChild(legend);
        }
        
        // Implementation of the d3-parliament-chart algorithm
        function calculateParliamentPoints(totalPoints, options, graphicWidth) {
            const graphicHeight = graphicWidth / 2;
            const { seatRadius, rowHeight, sectionGap } = options;
            
            // Use full semi-circle
            const startRad = 0; // Start at 0 (right side)
            const endRad = Math.PI;   // End at PI (left side)
            
            // Add padding to ensure seats aren't cut off
            const padding = seatRadius * 2;
            const graphRadius = graphicHeight - padding;
            const points = [];
            let currentRow = 0;
            
            while (points.length < totalPoints) {
                const currentRowRadius = graphRadius - (rowHeight * currentRow);
                
                // Calculate gap adjustment for this row
                const currentRowGapRad = Math.atan((seatRadius + (sectionGap / 2)) / currentRowRadius);
                const currentRowStartRad = startRad + currentRowGapRad;
                const currentRowEndRad = endRad - currentRowGapRad;
                
                if (currentRowEndRad <= currentRowStartRad || currentRowRadius <= 0) break;
                
                // Calculate minimum angular step based on seat size
                // Use tighter spacing for 650 seats
                const spacingFactor = totalPoints > 400 ? 2.0 : 2.5;
                const currRadStep = Math.atan((spacingFactor * seatRadius) / currentRowRadius);
                
                // Calculate how many seats fit in this row
                const rowSeats = Math.min(
                    Math.floor((currentRowEndRad - currentRowStartRad) / currRadStep),
                    totalPoints - points.length
                );
                
                // Calculate actual angular step for even distribution
                const roundedRadStep = rowSeats > 0
                    ? (currentRowEndRad - currentRowStartRad) / rowSeats
                    : 0;
                
                // Add seats for this row
                for (let currSeat = 0; currSeat < rowSeats; currSeat++) {
                    const currentAngle = rowSeats > 0
                        ? (currSeat * roundedRadStep + currentRowStartRad + roundedRadStep / 2)
                        : ((currentRowStartRad + currentRowEndRad) / 2);
                    
                    points.push({
                        x: Math.cos(currentAngle) * currentRowRadius + graphicHeight,
                        y: graphicHeight - Math.sin(currentAngle) * currentRowRadius - seatRadius
                    });
                }
                
                currentRow++;
            }
            
            return points;
        }

        function resetAllBallots() {
            const inputs = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].checked = false;
            }
            updateResults();
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', function() {
            createBallots(currentBallotCount);
            setDemoScenario();
            
            // Add event listener for the ballot slider
            document.getElementById('ballot-slider').addEventListener('input', function(e) {
                const newCount = parseInt(e.target.value);
                const oldCount = currentBallotCount;
                
                if (newCount !== oldCount) {
                    // Save current votes
                    const savedVotes = saveCurrentVotes();
                    
                    currentBallotCount = newCount;
                    createBallots(currentBallotCount);
                    
                    // Restore existing votes
                    restoreVotes(savedVotes);
                    
                    // Add random votes to new ballots
                    if (newCount > oldCount) {
                        for (let i = oldCount + 1; i <= newCount; i++) {
                            assignRandomVotes(i);
                        }
                    }
                    
                    updateBallotCount();
                    updateResults();
                }
            });
            
            // Randomly select 3 party checkboxes
            const allCheckboxes = document.querySelectorAll('.party-checkbox');
            const checkboxArray = Array.from(allCheckboxes);
            
            // Shuffle the array
            for (let i = checkboxArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [checkboxArray[i], checkboxArray[j]] = [checkboxArray[j], checkboxArray[i]];
            }
            
            // Check the first 3 checkboxes
            for (let i = 0; i < 3 && i < checkboxArray.length; i++) {
                checkboxArray[i].checked = true;
            }
        });
    </script>


</body></html>
